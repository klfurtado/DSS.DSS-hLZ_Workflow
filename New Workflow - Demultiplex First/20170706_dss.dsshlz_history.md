# DSS and DSS-hLZ Workflow (NEW!)

### July 6 2017

** Merging Reads**

Merged reads from DSS project again, to ensure that they were merged correctly and accurately.

Used Flash2 to merge

Script:

```
klfurtado@cabernet:/share/magalab/Kat/DSS/merged.reads$ cat flash2.dss.sh
#!/bin/bash
##

#SBATCH -o /share/magalab/Kat/DSS/merged.reads/merge.out
#SBATCH -e /share/magalab/Kat/DSS/merged.reads/merge.err
#SBATCH -n 4
#SBATCH -p animal_sciences
#SBATCH -t 8-00:00:00

echo "Setting up output and error directories, running 4 ntasks, partitioned to animal_sciences computer."

echo "Loading Flash2 module"
module load flash2/c41a82e

echo "Average read length should be 250 bp, average fragment length should be between 290 and 300, and quality threshold above 29."

echo "Options -r 250, -f 290, and -s 29 are used to calculate max overlap"

time flash2 /share/magalab/Kat/DSS/DSS_S1_L001_R1_001.fastq /share/magalab/Kat/DSS/DSS_S1_L001_R2_001.fastq -o dss -r 250 -f 290 -s 29

echo "Merging complete"
```

Output:
```
[FLASH] Read combination statistics:
[FLASH]     Total pairs:       16765099
[FLASH]     Discarded pairs:   0
[FLASH]     Percent Discarded: 0.00%
[FLASH]     Combined pairs:    16088672
[FLASH]     Uncombined pairs:  676427
[FLASH]     Percent combined:  95.97%
[FLASH]
[FLASH] Writing histogram files.
[FLASH]
[FLASH] FLASH v2.2.00 complete!
[FLASH] 654.203 seconds elapsed
Merging complete
```

Histogram:
```
251	2647
252	2385
253	2201
254	1908
255	1867
256	2350
257	3161
258	3500
259	3810
260	4031
261	3122
262	3868
263	4510
264	4361
265	6027
266	7353
267	7264
268	6615
269	8238
270	8097
271	9334
272	14780
273	15617
274	15615
275	15969
276	15646
277	16875
278	21073
279	45198
280	39336
281	75555
282	193544
283	105747
284	93975
285	116800
286	150090
287	185202
288	132648
289	129615
290	114477
291	150406
292	242799
293	122430
294	129445
295	112009
296	109547
297	122412
298	131117
299	178497
300	302348
301	2579643
302	9138339
303	197663
304	10115
305	3711
306	2150
307	1003
308	881
309	851
310	864
311	782
312	891
313	871
314	964
315	1013
316	1067
317	1186
318	1193
319	1273
320	1340
321	1492
322	1605
323	1691
324	1989
325	2091
326	2318
327	2526
328	2886
329	3146
330	3559
331	4081
332	4276
333	5004
334	5459
335	6021
336	6801
337	7788
338	8656
339	8274
340	8330
341	8201
342	8334
343	8581
344	9101
345	9328
346	9645
347	9924
348	10197
349	10410
350	10526
351	10752
352	11085
353	11140
354	11179
355	11150
356	11308
357	11289
358	11635
359	11154
360	11130
361	11274
362	11347
363	11117
364	10912
365	10908
366	10688
367	10755
368	10489
369	10354
370	10371
371	10226
372	10053
373	10055
374	9977
375	9713
376	9468
377	9522
378	9427
379	9300
380	9298
381	9186
382	8980
383	8861
384	8709
385	8823
386	8604
387	8706
388	8338
389	8364
390	8247
391	7790
392	8014
393	8067
394	7840
395	7457
396	7689
397	7257
398	7322
399	7308
400	7284
401	7154
402	6941
403	6933
404	6897
405	6893
406	6840
407	6495
408	6415
409	6453
410	6504
411	6274
412	6266
413	6078
414	5986
415	5959
416	5794
417	5680
418	5711
419	5593
420	5491
421	5441
422	5312
423	5263
424	5288
425	5095
426	5217
427	4976
428	4761
429	4836
430	4869
431	4599
432	4614
433	4491
434	4379
435	4352
436	4166
437	4135
438	4023
439	3880
440	3775
441	3743
442	3571
443	3439
444	3278
445	3221
446	3066
447	2951
448	2791
449	2591
450	2588
451	2358
452	2248
453	2155
454	1966
455	1824
456	1803
457	1651
458	1534
459	1417
460	1305
461	1235
462	1171
463	1048
464	908
465	927
466	810
467	714
468	746
469	630
470	604
471	521
472	447
473	502
474	401
475	373
476	430
477	392
478	335
479	278
480	288
481	235
482	292
483	245
484	241
485	228
486	262
487	237
488	262
489	272
490	342
491	225
492	359
```

Read lengths 282-303 appear to be most frequent.

**Converting Merged FASTQ to FASTA and qual file for Demultiplexing**

Using QIIME script ```convert_fastaqual_fastq.py```

Script:

```
#!/bin/bash
##

#SBATCH -o /share/magalab/Kat/DSS/merged.fastaqual/convert.out
#SBATCH -e /share/magalab/Kat/DSS/merged.fastaqual/convert.err
#SBATCH -n 4
#SBATCH -p animal_sciences
#SBATCH -t 8-00:00:00

echo "Setting up output and error directories, running 4 ntasks, partitioned to animal_sciences computer."

echo "Loading QIIME"

module load qiime/1.9.1

echo "Converting Merged reads to FASTA plus a quality file for demultiplexing."

time convert_fastaqual_fastq.py -c fastq_to_fastaqual -f /share/magalab/Kat/DSS/merged.reads/dss.extendedFrags.fastq -o /share/magalab/Kat/DSS/merged.fastaqual

echo "Done converting."
```
